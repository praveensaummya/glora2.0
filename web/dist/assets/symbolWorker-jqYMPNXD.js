(function(){"use strict";function g(u,a){if(!a)return{matches:!0,score:0};const o=u.toLowerCase(),e=a.toLowerCase();if(o===e)return{matches:!0,score:1e3};if(o.startsWith(e))return{matches:!0,score:900+e.length/o.length*100};if(o.includes(e))return{matches:!0,score:700-o.indexOf(e)+e.length/o.length*100};let n=0,t=0,r=0,l=-1;for(let c=0;c<o.length&&n<e.length;c++)o[c]===e[n]&&(t+=10,l===c-1?(r++,t+=r*5):r=0,(c===0||!o[c-1].match(/[a-z0-9]/i))&&(t+=20),l=c,n++);return n===e.length?(t=Math.min(t,600),{matches:!0,score:t}):{matches:!1,score:0}}function b(u,a,o={}){const{quoteAssets:e=[],baseAssets:n=[],minVolume:t=0,maxResults:r=100,fuzzy:l=!0}=o;if(!a&&e.length===0&&n.length===0&&t===0)return u.slice(0,r).map(s=>({...s,score:s.quoteVolume24h||0}));const c=[];for(const s of u){let i=0;if(e.length>0){if(!e.includes(s.quoteAsset))continue;i+=50}if(n.length>0){if(!n.includes(s.baseAsset))continue;i+=50}if(t>0){if((s.quoteVolume24h||0)<t)continue;i+=30}if(a)if(l){const f=g(s.symbol,a),h=g(s.baseAsset,a),m=g(s.quoteAsset,a),d=Math.max(f.score,h.score,m.score);if(!f.matches&&!h.matches&&!m.matches)continue;i+=d}else{const f=a.toLowerCase(),h=s.symbol.toLowerCase().includes(f),m=s.baseAsset.toLowerCase().includes(f),d=s.quoteAsset.toLowerCase().includes(f);if(!h&&!m&&!d)continue;h&&(i+=500),m&&(i+=300),d&&(i+=300)}else i+=(s.quoteVolume24h||0)/1e3;c.push({...s,score:i})}return c.sort((s,i)=>i.score-s.score),c.slice(0,r)}self.onmessage=function(u){const{type:a,data:o}=u.data;switch(a){case"filter":{const{symbols:e,query:n,options:t}=o,r=b(e,n,t);self.postMessage({type:"filtered",data:r});break}case"getTopByVolume":{const{symbols:e,quoteAsset:n,limit:t}=o;let r=e.filter(l=>!n||l.quoteAsset===n).sort((l,c)=>(c.quoteVolume24h||0)-(l.quoteVolume24h||0)).slice(0,t||50);self.postMessage({type:"filtered",data:r});break}case"getQuoteAssets":{const{symbols:e}=o,n=[...new Set(e.map(t=>t.quoteAsset))].sort();self.postMessage({type:"quoteAssets",data:n});break}default:console.warn("Unknown message type:",a)}}})();
